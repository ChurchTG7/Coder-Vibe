version: '3.8'

services:
  coder:
    image: ghcr.io/coder/coder:v2.27.9-amd64
    container_name: coder
    restart: unless-stopped
    ports:
      - "7080:7080"
    volumes:
      - coder-config:/home/coder
      - coder-data:/var/lib/coder
    environment:
      # Coder Web Server Configuration
      CODER_ADDRESS: 0.0.0.0:7080
      
      # Database Configuration (SQLite by default)
      CODER_POSTGRESQL_URL: "file:///var/lib/coder/coder.db"
      
      # Security Settings
      CODER_TLS_ENABLE: "false"
      CODER_SECURE_AUTH_COOKIE: "false"
      
      # Provisioner Configuration
      CODER_PROVISIONER_DAEMONS: "1"
      
      # Feature Flags
      CODER_ALLOW_PATH_APP_SHARING: "true"
      CODER_ALLOW_DEV_URLS: "true"
      CODER_DISABLE_SESSION_EXPIRY: "false"
      
    networks:
      - coder-network
    
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7080/api/v2/buildinfo"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  coder-config:
    driver: local
  coder-data:
    driver: local

networks:
  coder-network:
    driver: bridge
